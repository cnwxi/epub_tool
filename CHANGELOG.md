# 更新日志
### 2026.02.24<br>
修复字体混淆在 CSS 选择器路径下的替换范围：由递归后代文本改为仅处理命中元素的直系正文文本节点，避免父子节点字体混用时出现跨节点误替换（如 `）` 显示为 `컎`）。  
字符采集阶段同步收窄为直系正文文本，统一“采集-映射-替换”口径，降低映射污染。  
新增 `iter_direct_text_nodes` helper，仅返回直系且可见的正文文本节点，并过滤注释节点。by codex

### 2026.02.23<br>
修复字体混淆写回HTML时的符号保真：保留原文中的实体格式（`&lt;`、`&gt;`），避免显示用标签文本被错误还原为真实标签导致XHTML标签不匹配。  
保护占位符实现：改用包含随机UUID的长token，降低与正文字符碰撞风险，提升实体保护逻辑鲁棒性。  
进一步修复占位符冲突边界：为每个实体单独生成并校验完整token，确保若正文中出现token样式文本也不会被误恢复替换。by codex

更新测试样例文件：  
[下载链接](https://wwxq.lanzov.com/b0nz4q13i) 密码:8vfp

### 2026.02.15<br>
修复字体混淆遗漏字体与符号实体化问题。修复字体混淆遇到无glyf字体时报错。调整字符清理逻辑，保留标点以减少字体回退造成的大间距。by codex
### 2026.02.13<br>
优化字体加密选择与HTML列表生成，字体样式选择更新。增加加解密时对多看掌阅音视频私有属性文件链接的修改以修复加密后多看无法播放音频等问题。by codex
### 2025.11.23<br>
绑定MACOS右键功能，移除界面中emoji，修改默认显示字体，设置最小显示宽高。
### 2025.11.21<br>
UI更新：界面布局调整，添加拖拽功能，添加简要使用说明。
### 2025.07.06<br>
删除字体混淆部分注释掉的无用代码，删除字符清理部分无效代码；调整界面默认宽度；调整、清理模块依赖。
### 2025.06.17<br>
优化文件处理，现在会删除处理失败的输出文件；简化UI部分代码，优化处理中进度条显示；black格式化代码；更新日志迁移到`CHANGELOG.md`
### 2025.06.15<br>
增加WEBP格式图片转换功能。https://github.com/cnwxi/epub_tool/issues/25<br>
### 2025.04.27<br>
界面更新，使用ttk控件替换tk以实现跨平台统一；功能更新，增加右键点击快速打开所在/输出文件夹、删除已添加文件、查看日志文件等功能，添加鼠标悬停显示更多信息功能，添加字体加密功能。https://github.com/cnwxi/epub_tool/issues/21<br>
使用 `20230418《ePub指南——从入门到放弃》编著：赤霓（第2版）`进行字体加密测试，执行过程无报错，具体查看内容有部分字符因复杂样式导致被意外混淆。 [下载链接](https://wwxq.lanzov.com/b0nz4q13i) 密码:8vfp<br>
### 2025.04.23<br>
移除命令行程序编译；移除mac编译-F参数；添加icon.icns图标适配macOS，优化显示效果；移除Ubuntu（Linux系统）编译。<br>
### 2025.03.20<br>
修复失效的自定义输出路径。<br>
### 2025.03.01<br>
图标打包进可执行文件。<br>
### 2025.02.20<br>
更新图标。<br>
### 2024.12.25<br>
修复在mac上的日志文件写入位置，更改日志写入方式，清理原始脚本中重复的无效循环。<br>
### 2024.12.24<br>
Update build.yml。<br>
### 2024.12.23<br>
调整UI、取消push自动构建。<br>
### 2024.12.17<br>
修复UI显示问题,分支整合。<br>
### 2024.12.16<br>
创建新分支TKUI，实现基本UI DEMO，功能已整合。<br>
### 2024.11.17<br>
添加文件夹手动选择需要处理文件，输入文件序号进行选择，不再是默认处理文件夹内全部epub文件，添加了输入检测提示，错误后会返回重新输入。<br>
### 2024.10.24<br>
修复未处理输入时拖入文件带引号导致的文件路径检查错误。<br>
### 2024.09.09<br>
因额外依赖库未打包到可执行文件，重新打包可执行文件。<br>
更新相关使用教程。<br>
### 2024.09.08<br>
为避免有人不会使用命令行工具，更新Windows系统下相关操作的基础流程。<br>
程序允许直接双击执行，后续再输入参数。<br>
对应操作忽略固定后缀跳过文件处理。_encrypt、_decrypt、_reformat<br>
### 2024.08.29<br>
修复混淆ID导致的反混淆不完全。修复存在异常opf时程序闪退问题。更新日志记录。https://github.com/cnwxi/epub_tool/issues/11<br>
### 2024.08.28<br>
整合代码，使用命令行批量处理epub文件。支持输入单个epub文件或epub文件所在文件夹，支持子目录遍历。修改输出路径，现为原epub文件同级路径，通过添加不同后缀`encrypt\decrypt\reformat`区分原文件和处理后文件。https://github.com/cnwxi/epub_tool/issues/11<br>
### 2024.06.19<br>
代码更新，使用相似度计算覆盖opf文件中未混淆的其他文件名情况。<br>
### 2024.06.13<br>
更新yml文件。<br>
### 2024.06.12<br>
针对cover页面未混淆的情况做更改。<br>
修改自动发布逻辑，修改py文件不触发CI，仅修改yml后触发。修改yml，无需手动执行才执行发布。<br>
### 2024.06.08<br>
CI配置文件更新。<br>
### 2024.06.07<br>
修改主函数逻辑，防止epub文件不存在导致的程序崩溃。<br>
加入CI自动构建。<br>
加入CI自动发布。<br>
### 2024.05.28<br>
修正`重构epub为规范格式_v2.8.3.py`中生成的content.opf文件内容格式。<br>
### 2024.05.16<br>
更改文件输出路径。<br>
### 2024.05.09<br>
针对多看~slim文件进行修改，处理html中使用`../`、`./`、`/`开头的链接。https://github.com/cnwxi/epub_tool/issues/1<br>
### 2024.04.23<br>
初始化仓库。<br>
